<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ä»»åŠ¡æŠ½ç­¾</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; }
    select, button { padding: 10px; font-size: 16px; margin: 10px 0; }
    #result { margin-top: 20px; font-size: 18px; color: #2c7; }
  </style>
</head>
<body>
  <h2>ä»»åŠ¡æŠ½ç­¾ç³»ç»Ÿ</h2>
  <p>è¯·é€‰æ‹©ä½ çš„å§“åï¼š</p>
  <select id="nameSelect">
    <option value="">-- è¯·é€‰æ‹© --</option>
  </select>
  <br>
  <button onclick="draw()">æŠ½ ç­¾</button>
  <div id="result"></div>

  <script>
    async function loadParticipants() {
      const res = await fetch('/api/participants');
      const names = await res.json();
      const sel = document.getElementById('nameSelect');
      sel.innerHTML = '<option value="">-- è¯·é€‰æ‹© --</option>';
      names.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        sel.appendChild(opt);
      });
    }

    async function draw() {
      const name = document.getElementById('nameSelect').value;
      if (!name) { alert('è¯·å…ˆé€‰æ‹©å§“å'); return; }

      const res = await fetch('/api/draw', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name})
      });
      const data = await res.json();

      const resultDiv = document.getElementById('result');
      if (data.error) {
        resultDiv.innerHTML = `<span style="color:red">âŒ  $ {data.error}</span>`;
      } else {
        resultDiv.innerHTML = `ğŸ‰ <strong> $ {name}</strong>ï¼Œä½ æŠ½ä¸­äº†ï¼š<strong> $ {data.task}</strong>`;
        loadParticipants(); // åˆ·æ–°å¯é€‰åå•
      }
    }

    loadParticipants();
  </script>
</body>
</html>
